<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>globecurrency.org - AI Assistant</title>
    <!-- markdown-it -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
    <!-- dompurify -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <!-- prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-solidity.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Load Markdown parser -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="manifest" href="img/site.webmanifest">
    <link rel="mask-icon" href="img/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <meta name="description" content="Globe - The Future of Finance">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@globe_currency">
    <meta name="twitter:title" content="The Future of Finance">
    <meta name="twitter:description" content="globecurrency.org - The Future of Finance">
    <meta name="twitter:creator" content="@particlproject">
    <meta name="twitter:image" content="">
    <meta property="og:title" content="globecurrency.org - The Future of Finance">
    <meta property="og:type" content="Article">
    <meta property="og:url" content="https://globecurrency.org">
    <meta property="og:image" content="">
    <meta property="og:description" content="Globe - The Future of Finance">
    <meta property="og:site_name" content="Globe - The Future of Finance">
    <meta property="fb:admins" content="">
    <link rel="stylesheet" media="all" href="css/app.min.css">
    <script>
      var viewportmeta = document.querySelector('meta[name="viewport"]');
      if (viewportmeta) {
        if (screen.width < 375) {
          var newScale = screen.width / 375;
          viewportmeta.content = 'width=375, minimum-scale=' + newScale + ', maximum-scale=1.0, user-scalable=no, initial-scale=' + newScale + '';
        } else {
          viewportmeta.content = 'width=device-width, maximum-scale=1.0, initial-scale=1.0';
        }
      }
    </script>
  </head>
  <body>
    <script>
      console.log(localStorage.getItem('darkMode'));
      if (localStorage.getItem('darkMode') === "on") {
        document.body.classList.add("dark");
        document.addEventListener("DOMContentLoaded", function() {
          document.querySelector('.js-theme input').checked = true;
        });
      }
    </script>

    <div class="outer">
      <!-- header section (navigation bar) -->
      <header class="header js-header">
        <div class="header__center center"><a class="header__logo" href="https://globecurrency.org"><img class="some-icon" src="img/logo-dark.png" alt="Particl.io"><img class="some-icon-dark" src="img/logo-dark.png" alt="Particl.io"></a>
          <div class="header__wrap js-header-wrap">
            <nav class="header__nav"><a class="header__link" href="about">About</a><a class="header__link" href="coin">Coin</a><a class="header__link" href="ai">AI</a></nav>
            <div class="header__group">
              <div class="header__contacts">
                <div class="header__element">
                  <div class="header__subtitle"></div>
                  <div class="header__text"></div>
                </div>
              </div>
              <div class="header__socials"><a class="header__social" href="https://twitter.com/globe_currency" target="_blank" title="twitter">
                  <svg class="icon icon-twitter">
                    <use xlink:href="#icon-twitter"></use>
                  </svg></a><a class="header__social" href="https://discord.me/globecurrency" target="_blank" title="Discord">
                  <svg class="icon icon-discord">
                    <use xlink:href="#icon-discord"></use>
                  </svg></a><a class="header__social" href="https://www.reddit.com/r/globecurrency/" target="_blank" title="Reddit">
                  <svg class="icon icon-reddit">
                    <use xlink:href="#icon-reddit"></use>
                  </svg></a><a class="header__social" href="https://github.com/globeproject" target="_blank" title="Github">
                  <svg class="icon icon-github">
                    <use xlink:href="#icon-github"></use>
                  </svg></a></div><a class="button button-stroke button-small header__button" href="downloads">Install
                <svg class="icon icon-download">
                  <use xlink:href="#icon-download"></use>
                </svg></a>
            </div>
          </div><a class="button button-stroke button-small header__button" href="downloads">Install
            <svg class="icon icon-download">
              <use xlink:href="#icon-download"></use>
            </svg></a>
          <button class="header__burger js-header-burger"></button>
        </div>
      </header>

      <!-- AI Chat Section -->
      <div class="ai-chat-container center">
        <h1 class="h2">Globe AI Assistant</h1>
        <p>Ask our AI assistant anything about Globe, smart contracts, staking, privacy, and more.</p>
        <div class="ai-chat-log" id="chatLog"></div>
        <div class="ai-chat-input">
          <input type="text" id="userInput" placeholder="Type your question here..." />
          <button id="send-button">Send</button>
          <button id="stop-button" disabled aria-label="Stop Typing">
            &#10074;&#10074; <!-- Pause icon -->
          </button>
        </div>
      </div>
    </div>
      
    <script>
      const chatLog = document.getElementById('chatLog');
      const userInput = document.getElementById('userInput');
      const sendButton = document.getElementById('send-button');
      const stopButton = document.getElementById('stop-button');
      let typingTimeout;
    
      // Gradual word typing effect function
      function typeHtmlGradually(element, html, delay) {
        let words = html.split(' ');  // Split the message into words
        let index = 0;
        element.innerHTML = ''; // Clear previous content
    
        function typeNextWord() {
          if (index < words.length) {
            element.innerHTML += words[index] + ' '; // Add the next word and a space
            index++;
            typingTimeout = setTimeout(typeNextWord, delay); // Delay for next word
          }
        }
        typeNextWord();
      }
    
      // Stop button functionality to stop the typing effect
      stopButton.addEventListener('click', () => {
        clearTimeout(typingTimeout); // Stop typing effect
        stopButton.disabled = true; // Disable stop button after stopping
      });
    
      sendButton.addEventListener('click', async () => {
        const message = userInput.value.trim();
        if (!message) return;
    
        // Show user message
        const userMessageElement = document.createElement('div');
        userMessageElement.className = 'message user-message';
        userMessageElement.textContent = `You: ${message}`;
        chatLog.appendChild(userMessageElement);
    
        // Clear input
        userInput.value = '';
    
        // Disable the send button while generating AI response
        sendButton.disabled = true;
        stopButton.disabled = false; // Enable the stop button when the typing starts
    
        // Send message to Cloudflare Worker
        try {
          const response = await fetch('https://chatgpt-proxy.globecurrency25.workers.dev', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
          });
    
          const data = await response.json();
    
          // Render AI response (Markdown -> HTML)
          const aiMessageElement = document.createElement('div');
          aiMessageElement.className = 'message ai-message';
    
          // Use typeHtmlGradually for the AI response with word-by-word typing effect
          typeHtmlGradually(aiMessageElement, marked.parse(data.reply), 150); // 150ms delay per word
    
          chatLog.appendChild(aiMessageElement);
    
          // Auto-scroll to bottom
          chatLog.scrollTop = chatLog.scrollHeight;
        } catch (error) {
          const errorElement = document.createElement('div');
          errorElement.className = 'message ai-message';
          errorElement.textContent = `Error: ${error.message}`;
          chatLog.appendChild(errorElement);
        } finally {
          sendButton.disabled = false; // Re-enable the send button
        }
      });
    
      // Allow pressing Enter to send
      userInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          sendButton.click();
        }
      });
    </script>
    
    <style>
      /* General chat container styling */
      #chatLog {
        padding: 20px;
        background: #f1f1f1;
        max-height: 500px;
        overflow-y: auto;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-family: Arial, sans-serif;
      }
    
      /* Message styles */
      .message {
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 5px;
      }
    
      .user-message {
        background: #e1f5fe;
        color: #1e88e5;
      }
    
      .ai-message {
        background: #ffffff;
        color: #444;
        border: 1px solid #ddd;
      }
    
      /* Markdown-specific styles */
      p {
        margin-bottom: 15px;
        font-size: 16px;
        line-height: 1.5;
      }
    
      strong {
        font-weight: bold;
      }
    
      em {
        font-style: italic;
      }
    
      ul {
        margin-left: 20px;
        list-style-type: disc;
      }
    
      li {
        margin-bottom: 5px;
      }
    
      blockquote {
        margin: 10px 0;
        padding: 10px 15px;
        border-left: 4px solid #ccc;
        background: #f9f9f9;
        font-style: italic;
      }
    
      code {
        font-family: 'Courier New', Courier, monospace;
        background: #f4f4f4;
        padding: 3px 5px;
        border-radius: 3px;
      }
    
      pre code {
        background: #272c34;
        color: #f8f8f2;
        display: block;
        padding: 10px;
        border-radius: 5px;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
    
      a {
        color: #1e88e5;
        text-decoration: underline;
      }
    
      a:hover {
        color: #1565c0;
      }
    
      /* Optional: Styling for the input box and send button */
      #userInput {
        width: 80%;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border: 1px solid #ccc;
      }
    
      #send-button {
        padding: 10px 20px;
        background: #1e88e5;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
    
      #send-button:disabled {
        background: #ccc;
      }
    </style>    
  </body>
</html>